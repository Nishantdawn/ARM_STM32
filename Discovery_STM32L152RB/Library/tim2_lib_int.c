#include <stm32l1xx.h>

void  TIM2_IRQHandler(void)
{
	TIM2->SR=0;	
	GPIOB->ODR=~(GPIOB->ODR);

}


int main()
{
	NVIC_EnableIRQ(TIM2_IRQn);
	RCC->AHBENR |=RCC_AHBENR_GPIOBEN;

	GPIOB->MODER |=0X5000;
	GPIOB->OTYPER |=0X00;
	GPIOB->ODR |=GPIO_ODR_ODR_6;
	GPIOB->OSPEEDR |=GPIO_OSPEEDER_OSPEEDR6;
	GPIOB->PUPDR &=0X00;

	RCC->APB1ENR|=RCC_APB1ENR_TIM2EN;
	RCC->CR |=RCC_CR_MSION;
	RCC->CFGR |= RCC_CFGR_SW_MSI;
	TIM2->CR1 |=TIM_CR1_ARPE;
	TIM2->CR1 |=TIM_CR1_CEN;
	TIM2->EGR |=TIM_EGR_UG;
	TIM2->PSC =0x20;
	TIM2->ARR =0xFFFF;
	TIM2->DIER |=TIM_DIER_UIE;

while(1);
}
